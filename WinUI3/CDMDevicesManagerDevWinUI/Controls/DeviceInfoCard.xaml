<?xml version="1.0" encoding="utf-8" ?>
<UserControl x:Class="CDMDevicesManagerDevWinUI.Views.DeviceInfoCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="using:CDMDevicesManagerDevWinUI.Views"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!-- Settings Button Style -->
        <Style x:Key="SettingsButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{ThemeResource AccentButtonBackground}" />
            <Setter Property="Foreground" Value="{ThemeResource AccentButtonForeground}" />
            <Setter Property="Width" Value="40" />
            <Setter Property="Height" Value="40" />
            <Setter Property="CornerRadius" Value="20" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

        <!-- Config Button Style -->
        <Style x:Key="ConfigButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{ThemeResource AccentButtonBackground}" />
            <Setter Property="Foreground" Value="{ThemeResource AccentButtonForeground}" />
            <Setter Property="Height" Value="40" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Margin" Value="16,0" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
        </Style>

        <!-- Status Indicator Style -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="12" />
            <Setter Property="Height" Value="12" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="BorderBrush" Value="White" />
        </Style>

        <!-- Hover animations -->
        <Storyboard x:Name="HoverEnterStoryboard">
            <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                             Storyboard.TargetProperty="ScaleX" 
                             To="1.02" Duration="0:0:0.2" />
            <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                             Storyboard.TargetProperty="ScaleY" 
                             To="1.02" Duration="0:0:0.2" />
        </Storyboard>
        <Storyboard x:Name="HoverExitStoryboard">
            <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                             Storyboard.TargetProperty="ScaleX" 
                             To="1.0" Duration="0:0:0.2" />
            <DoubleAnimation Storyboard.TargetName="ScaleTransform" 
                             Storyboard.TargetProperty="ScaleY" 
                             To="1.0" Duration="0:0:0.2" />
        </Storyboard>
    </UserControl.Resources>

    <!-- Shadow container -->
    <Grid>
        <!-- Shadow (subtle gray border) -->
        <Border Background="Gray" 
                Opacity="0.2" 
                CornerRadius="12" 
                Margin="10,10,6,6" />
        
        <!-- Main card -->
        <Border BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Margin="8"
                Width="280"
                Height="380"
                PointerEntered="Card_PointerEntered"
                PointerExited="Card_PointerExited">
            <Border.RenderTransform>
                <ScaleTransform x:Name="ScaleTransform" CenterX="140" CenterY="190" />
            </Border.RenderTransform>
            
            <!-- Background Image with overlay -->
            <Grid>
                <!-- Background Image -->
                <Border CornerRadius="12">
                    <Border.Background>
                        <ImageBrush ImageSource="{x:Bind DeviceImagePath, Mode=OneWay}" 
                                    Stretch="UniformToFill" 
                                    Opacity="0.8" />
                    </Border.Background>
                </Border>
                
                <!-- Overlay for better text readability -->
                <Border Background="Black" Opacity="0.3" CornerRadius="12" />
                
                <!-- Main Content Grid -->
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" /><!-- Top Bar with Settings -->
                        <RowDefinition Height="*" />    <!-- Middle Content -->
                        <RowDefinition Height="Auto" /><!-- Bottom Button -->
                    </Grid.RowDefinitions>

                    <!-- Top Bar with Settings Button and Status -->
                    <Grid Grid.Row="0" Margin="16,16,16,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Settings Button (Top Left) -->
                        <Button Grid.Column="0" 
                                Style="{StaticResource SettingsButtonStyle}"
                                Click="SettingsButton_Click"
                                ToolTipService.ToolTip="Device Settings">
                            <FontIcon Glyph="&#xE713;" FontSize="16" />
                        </Button>

                        <!-- Status Indicator (Top Right) -->
                        <Border Grid.Column="2" 
                                Style="{StaticResource StatusIndicatorStyle}"
                                Background="{x:Bind GetStatusBrush(IsConnected), Mode=OneWay}"
                                ToolTipService.ToolTip="{x:Bind GetStatusText(IsConnected), Mode=OneWay}" />
                    </Grid>

                    <!-- Middle Content - Device Information -->
                    <StackPanel Grid.Row="1" 
                                VerticalAlignment="Center" 
                                Margin="16,20,16,20">
                        
                        <!-- Product Name (Large, Prominent) -->
                        <TextBlock Text="{x:Bind ProductName, Mode=OneWay}"
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Foreground="White"
                                   TextAlignment="Center"
                                   TextWrapping="Wrap"
                                   MaxLines="2"
                                   FontWeight="Bold"
                                   Margin="0,0,0,12" />

                        <!-- Serial Number (Prominent) -->
                        <Border Background="Black" 
                                Opacity="0.5" 
                                CornerRadius="8" 
                                Padding="12,8"
                                Margin="45,0,50,16">
                            <StackPanel>
                                <TextBlock Text="{x:Bind SerialNumber, Mode=OneWay}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           FontSize="12"
                                           Foreground="White"
                                           TextAlignment="Center"
                                           FontWeight="SemiBold" />
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Config Button (Bottom) -->
                    <Button Grid.Row="2" 
                            Style="{StaticResource ConfigButtonStyle}"
                            Click="ConfigButton_Click"
                            IsEnabled="{x:Bind IsConnected, Mode=OneWay}"
                            Margin="16,0,16,16">
                        <StackPanel Orientation="Horizontal" Spacing="9">
                            <FontIcon Glyph="&#xE70F;" FontSize="16" />
                            <TextBlock Text="Configure Device" 
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       FontWeight="SemiBold" />
                        </StackPanel>
                    </Button>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>