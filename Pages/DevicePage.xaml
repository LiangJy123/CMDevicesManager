<Page x:Class="CMDevicesManager.Pages.DevicePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      FontFamily="{DynamicResource AppFontFamily}"
      Title="{DynamicResource DevicePageTitle}"
      Loaded="Page_Loaded"
      Unloaded="Page_Unloaded"
      Background="Transparent">

    <Page.Resources>
        <!-- ✅ 全新配色方案 - 深蓝紫渐变 + 青色强调 -->
        <LinearGradientBrush x:Key="CardBg" StartPoint="0,0" EndPoint="1,1" Opacity="0.85">
            <GradientStop Color="#1A1F3A" Offset="0.0"/>
            <GradientStop Color="#2D1B3D" Offset="1.0"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="CardBorder" Color="#5B7FFF" Opacity="0.35"/>
        <SolidColorBrush x:Key="TitleBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="SubtitleBrush" Color="#B8C5FF"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#00D9FF"/>

        <DropShadowEffect x:Key="CardShadow" 
                          Color="#6B4FFF" 
                          Direction="270" 
                          ShadowDepth="6" 
                          Opacity="0.4" 
                          BlurRadius="20"/>

        <!-- 按钮渐变 -->
        <LinearGradientBrush x:Key="ConfigButtonBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#5B7FFF" Offset="0"/>
            <GradientStop Color="#7B8FFF" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="DisplayButtonBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#946EE0" Offset="0"/>
            <GradientStop Color="#A588FF" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="SettingsButtonBg" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#3A4A5E" Offset="0"/>
            <GradientStop Color="#4A5A6E" Offset="1"/>
        </LinearGradientBrush>
    </Page.Resources>

    <Grid>
        <!-- Status message area -->
        <Border x:Name="StatusBorder"
                CornerRadius="12"
                Margin="24,12"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                Padding="16,8"
                Visibility="Collapsed">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#00D9FF" Offset="0"/>
                    <GradientStop Color="#5B7FFF" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#00D9FF" 
                                  ShadowDepth="0" 
                                  BlurRadius="12" 
                                  Opacity="0.5"/>
            </Border.Effect>
            <TextBlock x:Name="StatusText"
                       Foreground="White"
                       FontWeight="SemiBold"
                       Text="{DynamicResource StatusMessagePlaceholder}"/>
        </Border>

        <!-- Main content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,60,0,0">
            <Grid>
                <!-- No devices message -->
                <Border x:Name="NoDevicesPanel"
                        CornerRadius="16"
                        Margin="24"
                        Padding="48"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="Collapsed">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1" Opacity="0.7">
                            <GradientStop Color="#1A1F3A" Offset="0.0"/>
                            <GradientStop Color="#2D1B3D" Offset="1.0"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Border.BorderBrush>
                        <SolidColorBrush Color="#5B7FFF" Opacity="0.3"/>
                    </Border.BorderBrush>
                    <Border.BorderThickness>1.5</Border.BorderThickness>
                    <Border.Effect>
                        <DropShadowEffect Color="#6B4FFF" 
                                          Direction="270" 
                                          ShadowDepth="4" 
                                          Opacity="0.3" 
                                          BlurRadius="16"/>
                    </Border.Effect>
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="&#xE7F4;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="64"
                                   Foreground="#5B7FFF"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="#5B7FFF" 
                                                  ShadowDepth="0" 
                                                  BlurRadius="20" 
                                                  Opacity="0.4"/>
                            </TextBlock.Effect>
                        </TextBlock>
                        <TextBlock Text="{DynamicResource NoConnectedDevices}"
                                   FontSize="24"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TitleBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,8"/>
                        <TextBlock Text="{DynamicResource ConnectDeviceTip}"
                                   FontSize="14"
                                   Foreground="{StaticResource SubtitleBrush}"
                                   HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- Device list -->
                <ItemsControl x:Name="DevicesItemsControl" ItemsSource="{Binding DeviceViewModels}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel IsItemsHost="True" Margin="24" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- ✅ 深蓝紫渐变卡片 -->
                            <Border x:Name="DeviceCard"
                                    CornerRadius="16"
                                    Margin="12"
                                    Width="280"
                                    Height="420"
                                    ClipToBounds="True">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1" Opacity="0.85">
                                        <GradientStop Color="#1A1F3A" Offset="0.0"/>
                                        <GradientStop Color="#2D1B3D" Offset="1.0"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.BorderBrush>
                                    <SolidColorBrush Color="#5B7FFF" Opacity="0.4"/>
                                </Border.BorderBrush>
                                <Border.BorderThickness>1.5</Border.BorderThickness>
                                <Border.Effect>
                                    <DropShadowEffect Color="#6B4FFF" 
                                                      BlurRadius="20" 
                                                      ShadowDepth="6" 
                                                      Opacity="0.4" />
                                </Border.Effect>
                                <Border.RenderTransform>
                                    <ScaleTransform x:Name="CardScale" ScaleX="1" ScaleY="1"/>
                                </Border.RenderTransform>

                                <Grid>
                                    <!-- Device image or placeholder -->
                                    <Border CornerRadius="16" ClipToBounds="True">
                                        <!-- Default device icon with gradient -->
                                        <Border CornerRadius="16">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1" Opacity="0.6">
                                                    <GradientStop Color="#242A45" Offset="0.0"/>
                                                    <GradientStop Color="#1A1F3A" Offset="1.0"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                <TextBlock Text="&#xE7F4;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="72"
                                                           Foreground="#5B7FFF"
                                                           HorizontalAlignment="Center">
                                                    <TextBlock.Effect>
                                                        <DropShadowEffect Color="#5B7FFF" 
                                                                          ShadowDepth="0" 
                                                                          BlurRadius="16" 
                                                                          Opacity="0.5"/>
                                                    </TextBlock.Effect>
                                                </TextBlock>
                                                <TextBlock Text="{DynamicResource DevicePlaceholder}"
                                                           FontSize="14"
                                                           Foreground="{StaticResource SubtitleBrush}"
                                                           HorizontalAlignment="Center"
                                                           Margin="0,8,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </Border>

                                    <!-- Gradient fade for text legibility -->
                                    <Border VerticalAlignment="Top"
                                            Height="120"
                                            CornerRadius="16,16,0,0">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="#CC000000" Offset="0"/>
                                                <GradientStop Color="#22000000" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>

                                    <!-- Device information -->
                                    <StackPanel Orientation="Vertical" Margin="16" VerticalAlignment="Top">
                                        <TextBlock Text="{Binding ProductString}"
                                                   Foreground="White"
                                                   FontSize="18"
                                                   FontWeight="Bold"
                                                   TextWrapping="Wrap">
                                            <TextBlock.Effect>
                                                <DropShadowEffect Color="#000000" 
                                                                  ShadowDepth="1" 
                                                                  BlurRadius="4" 
                                                                  Opacity="0.8"/>
                                            </TextBlock.Effect>
                                        </TextBlock>
                                        <TextBlock Text="{Binding ManufacturerString}"
                                                   Foreground="#CCFFFFFF"
                                                   FontSize="12"
                                                   Opacity="0.9"
                                                   Margin="0,2,0,0"/>
                                        <TextBlock Text="{Binding SerialNumber}"
                                                   Foreground="#B8C5FF"
                                                   FontSize="11"
                                                   Opacity="0.8"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- ✅ 连接状态指示器 - 青色 -->
                                    <Border Width="12" Height="12"
                                            CornerRadius="6"
                                            Background="#00D9FF"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Top"
                                            Margin="16">
                                        <Border.Effect>
                                            <DropShadowEffect Color="#00D9FF" 
                                                              BlurRadius="12" 
                                                              ShadowDepth="0" 
                                                              Opacity="0.8"/>
                                        </Border.Effect>
                                    </Border>

                                    <!-- ✅ 深蓝紫渐变按钮 -->
                                    <StackPanel x:Name="ActionButtonsPanel"
                                                Orientation="Vertical"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Bottom"
                                                Margin="12,0,12,16"
                                                Opacity="0">

                                        <!-- Config Button -->
                                        <Button x:Name="ConfigButton"
                                                Click="ConfigButton_Click"
                                                Background="{StaticResource ConfigButtonBg}"
                                                Foreground="White"
                                                BorderBrush="Transparent"
                                                Padding="8,8"
                                                Margin="0,0,0,0"
                                                Cursor="Hand"
                                                Width="200">
                                            <Button.Effect>
                                                <DropShadowEffect Color="#5B7FFF" 
                                                                  ShadowDepth="0" 
                                                                  BlurRadius="10" 
                                                                  Opacity="0.4"/>
                                            </Button.Effect>
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border"
                                                            Background="{TemplateBinding Background}"
                                                            CornerRadius="12"
                                                            Padding="{TemplateBinding Padding}">
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <TextBlock Text="&#xE713;"
                                                                       FontFamily="Segoe MDL2 Assets"
                                                                       FontSize="14"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,0,10,0"/>
                                                            <TextBlock Text="{DynamicResource ScreenCustomize}"
                                                                       FontSize="11"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#6B7FFF" Offset="0"/>
                                                                        <GradientStop Color="#8B9FFF" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#4B6FEF" Offset="0"/>
                                                                        <GradientStop Color="#6B8FFF" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        <!-- Display Mode Button -->
                                        <Button x:Name="DisplayModeButton"
                                                Background="{StaticResource DisplayButtonBg}"
                                                Foreground="White"
                                                BorderBrush="Transparent"
                                                Padding="8,8"
                                                Margin="0,6,0,0"
                                                Cursor="Hand"
                                                Width="200"
                                                Click="DisplayModeButton_Click">
                                            <Button.Effect>
                                                <DropShadowEffect Color="#946EE0" 
                                                                  ShadowDepth="0" 
                                                                  BlurRadius="10" 
                                                                  Opacity="0.4"/>
                                            </Button.Effect>
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border"
                                                            Background="{TemplateBinding Background}"
                                                            CornerRadius="12"
                                                            Padding="{TemplateBinding Padding}">
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <TextBlock Text="&#xE7F4;"
                                                                       FontFamily="Segoe MDL2 Assets"
                                                                       FontSize="14"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,0,10,0"/>
                                                            <TextBlock Text="{DynamicResource PlayMode}"
                                                                       FontSize="11"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#A67EF0" Offset="0"/>
                                                                        <GradientStop Color="#B598FF" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#865ED0" Offset="0"/>
                                                                        <GradientStop Color="#9678EF" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>

                                        <!-- Settings Button -->
                                        <Button x:Name="SettingsButton"
                                                Click="SettingsButton_Click"
                                                Background="{StaticResource SettingsButtonBg}"
                                                Foreground="White"
                                                BorderBrush="Transparent"
                                                Padding="8,8"
                                                Margin="0,6,0,0"
                                                Cursor="Hand"
                                                Width="200">
                                            <Button.Effect>
                                                <DropShadowEffect Color="#3A4A5E" 
                                                                  ShadowDepth="0" 
                                                                  BlurRadius="8" 
                                                                  Opacity="0.3"/>
                                            </Button.Effect>
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border"
                                                            Background="{TemplateBinding Background}"
                                                            CornerRadius="12"
                                                            Padding="{TemplateBinding Padding}">
                                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                            <TextBlock Text="&#xE115;"
                                                                       FontFamily="Segoe MDL2 Assets"
                                                                       FontSize="14"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"
                                                                       Margin="0,0,10,0"/>
                                                            <TextBlock Text="{DynamicResource FirmwareInfo}"
                                                                       FontSize="11"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{TemplateBinding Foreground}"
                                                                       HorizontalAlignment="Center"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#4A5A6E" Offset="0"/>
                                                                        <GradientStop Color="#5A6A7E" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                        <Trigger Property="IsPressed" Value="True">
                                                            <Setter TargetName="border" Property="Background">
                                                                <Setter.Value>
                                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                                        <GradientStop Color="#2A3A4E" Offset="0"/>
                                                                        <GradientStop Color="#3A4A5E" Offset="1"/>
                                                                    </LinearGradientBrush>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>
                                    </StackPanel>
                                </Grid>

                                <!-- Card hover effects -->
                                <Border.Triggers>
                                    <EventTrigger RoutedEvent="MouseEnter">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="CardScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.03" Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="CardScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.03" Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseOut"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="1" Duration="0:0:0.25">
                                                    <DoubleAnimation.EasingFunction>
                                                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                    <EventTrigger RoutedEvent="MouseLeave">
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="CardScale"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseIn"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="CardScale"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1" Duration="0:0:0.15">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseIn"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                                <DoubleAnimation Storyboard.TargetName="ActionButtonsPanel"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0" Duration="0:0:0.2">
                                                    <DoubleAnimation.EasingFunction>
                                                        <CubicEase EasingMode="EaseIn"/>
                                                    </DoubleAnimation.EasingFunction>
                                                </DoubleAnimation>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </Border.Triggers>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>